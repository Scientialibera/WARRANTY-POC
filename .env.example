# ============================================================================
# WARRANTY POC - Environment Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# Azure OpenAI Configuration
# ----------------------------------------------------------------------------
AZURE_OPENAI_ENDPOINT=https://aura-ai-foundry-2025.cognitiveservices.azure.com/
AZURE_OPENAI_DEPLOYMENT=gpt-4.1
AZURE_OPENAI_API_VERSION=2025-03-01-preview

# ----------------------------------------------------------------------------
# MCP Authorization (OAuth 2.1)
# ----------------------------------------------------------------------------
# Set to "true" for Azure deployment with OAuth 2.1 token validation
# Set to "false" for local development (no authentication)
MCP_AUTHORIZATION=false

# ----------------------------------------------------------------------------
# Azure Authentication
# ----------------------------------------------------------------------------
# Use Azure Managed Identity for token acquisition
USE_MANAGED_IDENTITY=false

# Azure token scope for OpenAI and MCP servers
AZURE_TOKEN_SCOPE=https://cognitiveservices.azure.com/.default

# Microsoft Entra ID (Azure AD) Tenant ID
# Required when MCP_AUTHORIZATION=true
ENTRA_TENANT_ID=

# ----------------------------------------------------------------------------
# Warranty MCP Server Configuration
# ----------------------------------------------------------------------------
# Local development
WARRANTY_PORT=8002

# Azure deployment URL (leave empty for local)
# Example: https://warranty-mcp.azurecontainerapps.io/mcp
WARRANTY_URL=

# OAuth 2.1 Settings (when MCP_AUTHORIZATION=true)
# RFC 8707 Audience - MUST match the intended resource server
WARRANTY_AUDIENCE=api://warranty-mcp-server

# Required Azure AD role for warranty server access
WARRANTY_REQUIRED_ROLE=Warranty.Read

# Token validation endpoint (auto-configured if ENTRA_TENANT_ID is set)
# Example: https://login.microsoftonline.com/{tenant-id}/discovery/v2.0/keys
WARRANTY_TOKEN_VALIDATION_URI=

# ----------------------------------------------------------------------------
# Actions MCP Server Configuration
# ----------------------------------------------------------------------------
# Local development
ACTIONS_PORT=8003

# Azure deployment URL (leave empty for local)
# Example: https://actions-mcp.azurecontainerapps.io/mcp
ACTIONS_URL=

# OAuth 2.1 Settings (when MCP_AUTHORIZATION=true)
# RFC 8707 Audience - MUST match the intended resource server
ACTIONS_AUDIENCE=api://actions-mcp-server

# Required Azure AD role for actions server access
ACTIONS_REQUIRED_ROLE=Warranty.Actions

# Token validation endpoint (auto-configured if ENTRA_TENANT_ID is set)
# Example: https://login.microsoftonline.com/{tenant-id}/discovery/v2.0/keys
ACTIONS_TOKEN_VALIDATION_URI=

# ============================================================================
# DEPLOYMENT SCENARIOS
# ============================================================================

# ----------------------------------------------------------------------------
# Scenario 1: Local Development (No Auth)
# ----------------------------------------------------------------------------
# MCP_AUTHORIZATION=false
# WARRANTY_PORT=8002
# ACTIONS_PORT=8003
# (All other MCP settings can be empty)

# ----------------------------------------------------------------------------
# Scenario 2: Azure Deployment with OAuth 2.1
# ----------------------------------------------------------------------------
# MCP_AUTHORIZATION=true
# USE_MANAGED_IDENTITY=true
# ENTRA_TENANT_ID=your-tenant-id
# WARRANTY_URL=https://warranty-mcp.azurecontainerapps.io/mcp
# WARRANTY_AUDIENCE=api://warranty-mcp-server
# WARRANTY_REQUIRED_ROLE=Warranty.Read
# ACTIONS_URL=https://actions-mcp.azurecontainerapps.io/mcp
# ACTIONS_AUDIENCE=api://actions-mcp-server
# ACTIONS_REQUIRED_ROLE=Warranty.Actions

# ============================================================================
# NOTES
# ============================================================================
# 
# OAuth 2.1 Token Validation:
# - Servers validate tokens per OAuth 2.1 Section 5.2
# - Audience validation per RFC 8707 Section 2
# - Invalid/expired tokens receive HTTP 401
# - Insufficient permissions receive HTTP 403
# 
# Token Acquisition:
# - Client uses Azure DefaultAzureCredential
# - Separate tokens obtained for each server (different audiences)
# - Tokens sent via Authorization: Bearer header
# 
# Security:
# - Servers ONLY accept tokens issued for their specific audience
# - Servers MUST NOT accept or transit tokens for other resources
# - JWKS keys cached for 1 hour to reduce validation latency
